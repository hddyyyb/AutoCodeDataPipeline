templates:
  - id: pre_reserve_stock_ttl
    domain: stock
    difficulty: medium
    title: 增加预占库存超时释放机制
    requirement: |
      当前系统存在下单后库存被预占,但用户长时间不支付导致库存占用的问题。
      请在不破坏现有订单与库存模块架构的情况下,设计“预占库存有效期TTL+超时自动释放”能力。
      需要说明:新增/改动的组件、接口、数据结构、关键流程、幂等与并发控制策略。
  - id: order_audit_log
    domain: order
    difficulty: easy
    title: 增加订单状态变更审计
    requirement: |
      需要对订单状态变更进行审计记录,包括变更前后状态、触发来源、时间、关联请求标识。
      请基于现有代码仓的分层模式,设计实现方案并说明如何与现有状态流转逻辑集成。
  - id: payment_reconcile_compensation
    domain: order
    difficulty: hard
    title: 支付回调对账与补偿
    requirement: |
      支付回调存在丢失或重复通知的风险。
      设计“支付对账+补偿任务”机制,确保订单最终一致(支付成功则确认订单并扣减库存,失败则释放库存)。
      需要说明:任务调度、幂等键设计、异常补偿、与现有支付回调接口如何衔接。
